<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Coil Data Checker</title>
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      margin: 0;
      padding: 0;
      font-family: 'Comic Neue', cursive, sans-serif;
      background: linear-gradient(135deg, #2c3e50, #3498db);
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px 8px;
      overflow-x: hidden;
    }
    
    .header-title {
      text-align: center;
      margin-bottom: 15px;
    }
    
    .header-title h1 {
      font-size: 24px;
      font-weight: bold;
      color: #00ff66;
      text-shadow: 1px 1px 3px #000;
      margin: 0;
      line-height: 1.3;
    }
    
    .container {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 16px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
      width: 100%;
      max-width: 500px;
    }
    
    .section {
      background: rgba(255, 255, 255, 0.05);
      margin-bottom: 15px;
      padding: 15px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .button-row {
      display: flex;
      gap: 10px;
      margin: 10px 0;
    }
    
    .half-width {
      flex: 1;
      margin: 0 !important;
    }
    
    .third-width {
      flex: 1;
      margin: 0 !important;
    }
    
    .coil-details-display {
      background-color: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 15px;
      min-height: 60px;
      margin-top: 10px;
    }
    
    /* Mobile-optimized input styling */
    input, button {
      width: 100%;
      padding: 14px;
      margin: 8px 0;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      touch-action: manipulation;
    }
    
    input[type="text"], input[type="file"] {
      background: #ecf0f1;
      color: #2c3e50;
      font-family: 'Comic Neue', cursive, sans-serif;
    }
    
    input[type="text"]:focus {
      outline: none;
      box-shadow: 0 0 0 2px #00ff66;
    }
    
    button {
      background-color: #1abc9c;
      color: white;
      font-weight: bold;
      cursor: pointer;
      font-family: 'Comic Neue', cursive, sans-serif;
      transition: all 0.2s ease;
    }
    
    button:active {
      transform: scale(0.98);
      background-color: #16a085;
    }
    
    button.clear-button {
      background-color: #e74c3c;
    }
    
    button.clear-button:active {
      background-color: #c0392b;
    }
    
    button:disabled {
      background-color: #7f8c8d;
      cursor: not-allowed;
      opacity: 0.6;
    }
    
    /* Section headers */
    h2 {
      font-size: 18px;
      margin: 0 0 15px 0;
      text-align: left;
      color: #fff;
      font-weight: bold;
    }
    
    /* Suggestion dropdowns */
    #suggestions, #vehicleSuggestions, #reportVehicleSuggestions {
      background: white;
      color: #2c3e50;
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
      position: absolute;
      width: calc(100% - 30px);
      z-index: 10;
      display: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      border: 1px solid #ddd;
    }
    
    #suggestions div, #vehicleSuggestions div, #reportVehicleSuggestions div {
      padding: 14px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
      font-size: 16px;
      font-family: 'Comic Neue', cursive, sans-serif;
    }
    
    #suggestions div:hover, #vehicleSuggestions div:hover, #reportVehicleSuggestions div:hover {
      background-color: #f8f9fa;
    }
    
    #suggestions div:last-child, #vehicleSuggestions div:last-child, #reportVehicleSuggestions div:last-child {
      border-bottom: none;
    }
    
    /* Result display - remove default styles since we're using coil-details-display */
    
    #result table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    
    #result table td {
      padding: 8px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      word-wrap: break-word;
      vertical-align: top;
    }
    
    #result table tr:nth-child(even) {
      background-color: rgba(0, 0, 0, 0.1);
    }
    
    /* QR Code Scanner */
    #reader {
      width: 100%;
      margin-top: 15px;
      border-radius: 8px;
      overflow: hidden;
      background: rgba(0, 0, 0, 0.3);
      min-height: 50px;
    }
    
    .input-container {
      position: relative;
    }
    
    /* File name display */
    #fileName {
      color: #ecf0f1;
      font-size: 14px;
      margin: 5px 0;
      text-align: center;
      word-wrap: break-word;
    }
    
    /* Added coils display */
    #addedCoils {
      margin-top: 15px;
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      border-radius: 8px;
      font-size: 14px;
      min-height: 20px;
    }
    
    #addedCoils h3 {
      margin: 0 0 10px 0;
      color: #00ff66;
      font-size: 16px;
    }
    
    /* Touch-friendly file input */
    input[type="file"] {
      background: rgba(255, 255, 255, 0.9);
      border: 2px dashed #3498db;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      font-size: 14px;
      padding: 20px;
    }
    
    input[type="file"]::-webkit-file-upload-button {
      background: #3498db;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    
    /* Mobile responsive adjustments */
    @media (max-width: 480px) {
      body {
        padding: 10px 5px;
      }
      
      .header-title h1 {
        font-size: 20px;
      }
      
      .container {
        padding: 12px;
      }
      
      input, button {
        font-size: 16px;
        padding: 12px;
      }
      
      h2 {
        font-size: 16px;
      }
      
      #suggestions, #vehicleSuggestions, #reportVehicleSuggestions {
        font-size: 14px;
      }
      
      #suggestions div, #vehicleSuggestions div, #reportVehicleSuggestions div {
        padding: 12px;
      }
    }
    
    /* Very small screens */
    @media (max-width: 320px) {
      .header-title h1 {
        font-size: 18px;
      }
      
      input, button {
        font-size: 14px;
        padding: 10px;
      }
      
      .container {
        padding: 10px;
      }
    }
    
    /* Prevent zoom on iOS */
    @media screen and (-webkit-min-device-pixel-ratio: 0) {
      input, textarea, select {
        font-size: 16px !important;
      }
    }
  </style>
</head>
<body>
  <div class="header-title">
    <h1>A.S.Shipping Agencies Pvt Ltd,<br>(Greenways Group) - V : 3.2</h1>
  </div>

  <div class="container">
    <!-- Coil Details Section -->
    <div class="section">
      <h2>Coil Details</h2>
      <div id="result" class="coil-details-display"></div>
    </div>

    <!-- Coil Processing Section -->
    <div class="section">
      <h2>Coil Processing</h2>
      <div class="input-container">
        <input type="text" id="coilInput" placeholder="Enter Coil Number" oninput="showSuggestions(); toggleClearButton();" autocomplete="off" />
        <div id="suggestions"></div>
      </div>
      <div class="input-container">
        <input type="text" id="vehicleInput" placeholder="Enter Vehicle Number" oninput="showVehicleSuggestions(); toggleVehicleClearButton();" autocomplete="off" />
        <div id="vehicleSuggestions"></div>
      </div>
      
      <div class="button-row">
        <button class="third-width" onclick="startScanner()">Scan QR</button>
        <button class="third-width" id="addBtn" onclick="addCoilToVehicle()">Add Coil</button>
        <button class="third-width clear-button" onclick="clearInputs()">Clear</button>
      </div>
      
      <div class="button-row">
        <button class="third-width" id="saveBtn" onclick="saveVehicleCoils()">Save</button>
        <button class="third-width" id="generateBtn" onclick="generateTextFile()" disabled>Generate Text</button>
        <button class="third-width clear-button" id="clearVehicleBtn" onclick="clearVehicleInput()" style="display: none;">Clear Vehicle</button>
      </div>
      
      <div id="reader" ondblclick="closeScanner()"></div>
      <div id="addedCoils"></div>
    </div>

    <!-- Generate Reports Section -->
    <div class="section">
      <h2>Generate Reports</h2>
      <div class="input-container">
        <input type="text" id="reportVehicleInput" placeholder="Enter Vehicle Number for Report" oninput="showReportVehicleSuggestions(); toggleReportVehicleClearButton();" autocomplete="off" />
        <div id="reportVehicleSuggestions"></div>
      </div>
      <div class="button-row">
        <button class="half-width" onclick="generateAllOutDataReport()">All OUT Data Report</button>
        <button class="half-width" onclick="generateVehicleOutReport()">Generate Vehicle Report</button>
      </div>
      <button id="clearReportVehicleBtn" class="clear-button" onclick="clearReportVehicleInput()" style="display: none;">Clear Report Vehicle</button>
    </div>

    <!-- File Management Section -->
    <div class="section">
      <h2>File Management</h2>
      <input type="file" id="excelFile" accept=".xlsx, .xls" />
      <p id="fileName"></p>
      <div class="button-row">
        <button class="third-width" onclick="downloadExcel()">Download Excel</button>
        <button class="third-width clear-button" onclick="clearLocalStorage()">Clear Storage</button>
        <button class="third-width clear-button" onclick="resetApp()">Clear All</button>
      </div>
      <div class="button-row">
        <button class="half-width" onclick="updateAppFromGithub()" style="background-color: #3498db;">Update App</button>
        <button class="half-width" onclick="setGithubToken()" style="background-color: #27ae60;">Set GitHub Token</button>
      </div>
    </div>
  </div>

  <!-- EXACT SAME JAVASCRIPT AS ORIGINAL -->
  <script>
    let coilData = [];
    let vehicleData = [];
    let outData = [];
    let loadedFileName = '';
    let addedCoils = [];
    let vehicleCoilMap = {};
    let html5QrCode;
    let serialCounter = 1;
    const GITHUB_EXCEL_URL = 'https://raw.githubusercontent.com/gmanand23/Coil_Info/main/coil-data.xlsx?' + new Date().getTime();
    const GITHUB_HTML_URL = 'https://raw.githubusercontent.com/gmanand23/Coil_Info/main/index.html?' + new Date().getTime();
    
    // GitHub token - will be provided by the server environment
    const GITHUB_TOKEN = window.GITHUB_TOKEN || 'YOUR_GITHUB_TOKEN_HERE';

    // Function to directly update GitHub Excel file (OUT sheet) - Multi-user support
    async function storeDataInGithubExcel(outEntries) {
      try {
        console.log('Directly updating GitHub Excel OUT sheet:', outEntries);
        
        // Store locally as backup for immediate access
        const allGithubData = JSON.parse(localStorage.getItem('githubOutData') || '[]');
        allGithubData.push(...outEntries);
        localStorage.setItem('githubOutData', JSON.stringify(allGithubData));
        
        // GitHub repository details
        const GITHUB_OWNER = 'gmanand23';
        const GITHUB_REPO = 'Coil_Info';
        const FILE_PATH = 'coil-data.xlsx';
        
        // Create a GitHub API endpoint URL (you'll need to implement server-side endpoint)
        const GITHUB_API_ENDPOINT = '/api/update-excel'; // Server endpoint to handle GitHub updates
        
        // For now, we'll use a direct approach with user-provided token
        let githubToken = localStorage.getItem('githubToken');
        if (!githubToken) {
          githubToken = prompt('Enter your GitHub Personal Access Token for direct updates:\n(This will be stored locally for future use)');
          if (githubToken) {
            localStorage.setItem('githubToken', githubToken);
          } else {
            throw new Error('GitHub token required for direct updates');
          }
        }
        
        // Fetch current file from GitHub API
        const response = await fetch(`https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${FILE_PATH}`, {
          headers: {
            'Authorization': `token ${githubToken}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });
        
        if (response.ok) {
          const fileData = await response.json();
          const currentContent = atob(fileData.content);
          
          // Parse the Excel file
          const workbook = XLSX.read(currentContent, { type: 'binary' });
          
          // Find or create OUT sheet
          let outSheet;
          if (workbook.SheetNames.includes('OUT')) {
            outSheet = workbook.Sheets['OUT'];
          } else {
            outSheet = XLSX.utils.json_to_sheet([]);
            workbook.SheetNames.push('OUT');
            workbook.Sheets['OUT'] = outSheet;
          }
          
          // Convert current OUT sheet to JSON
          const existingData = XLSX.utils.sheet_to_json(outSheet);
          
          // Append new entries
          const updatedData = [...existingData, ...outEntries];
          
          // Create new worksheet with updated data
          const newOutSheet = XLSX.utils.json_to_sheet(updatedData);
          workbook.Sheets['OUT'] = newOutSheet;
          
          // Write workbook back to binary
          const updatedContent = XLSX.write(workbook, { type: 'binary', bookType: 'xlsx' });
          const updatedBase64 = btoa(updatedContent);
          
          // Update file on GitHub
          const updateResponse = await fetch(`https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${FILE_PATH}`, {
            method: 'PUT',
            headers: {
              'Authorization': `token ${githubToken}`,
              'Content-Type': 'application/json',
              'Accept': 'application/vnd.github.v3+json'
            },
            body: JSON.stringify({
              message: `Update OUT data: ${outEntries.length} new entries`,
              content: updatedBase64,
              sha: fileData.sha
            })
          });
          
          if (updateResponse.ok) {
            console.log('Successfully updated GitHub Excel file');
          } else {
            throw new Error('Failed to update GitHub file');
          }
        } else {
          throw new Error('Failed to fetch current GitHub file');
        }
      } catch (error) {
        console.error('Error updating GitHub Excel:', error);
        throw error; // Re-throw to be handled by caller
      }
    }

    // Function to load OUT data from GitHub Excel file for comprehensive reporting
    async function loadOutDataFromGithub() {
      try {
        // First try to get from local cache if available and recent
        const cachedData = localStorage.getItem('githubOutData');
        const cacheTimestamp = localStorage.getItem('githubOutDataTimestamp');
        const now = Date.now();
        
        // Use cache if it's less than 5 minutes old
        if (cachedData && cacheTimestamp && (now - parseInt(cacheTimestamp)) < 300000) {
          const cached = JSON.parse(cachedData);
          console.log('Using cached OUT data:', cached.length, 'records');
          return cached;
        }
        
        // Load fresh data from GitHub
        console.log('Loading fresh OUT data from GitHub...');
        const response = await fetch(GITHUB_EXCEL_URL);
        if (!response.ok) {
          throw new Error(`Failed to fetch Excel file from GitHub (${response.status})`);
        }
        
        const arrayBuffer = await response.arrayBuffer();
        const workbook = XLSX.read(new Uint8Array(arrayBuffer), { type: 'array' });
        
        console.log('Available sheets:', workbook.SheetNames);
        
        if (workbook.SheetNames.includes('OUT')) {
          const outSheet = workbook.Sheets['OUT'];
          const githubOutData = XLSX.utils.sheet_to_json(outSheet);
          
          console.log('Loaded OUT data from GitHub:', githubOutData.length, 'records');
          
          // Cache the data
          localStorage.setItem('githubOutData', JSON.stringify(githubOutData));
          localStorage.setItem('githubOutDataTimestamp', now.toString());
          
          return githubOutData;
        } else {
          console.log('No OUT sheet found in GitHub Excel file');
          return [];
        }
      } catch (error) {
        console.error('Error loading OUT data from GitHub:', error);
        // Return local backup data if available
        const backupData = localStorage.getItem('githubOutData');
        if (backupData) {
          console.log('Using backup OUT data from localStorage');
          return JSON.parse(backupData);
        }
        console.log('No backup OUT data available');
        return [];
      }
    }

    // Function to format date and time for Excel storage
    function formatDateTime(date) {
      return date.toLocaleString('en-GB', {
        day: '2-digit',
        month: '2-digit', 
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        hour12: true
      });
    }

    // Load initial data when page loads
    document.addEventListener('DOMContentLoaded', async function() {
      // Load saved data
      const savedCoilData = localStorage.getItem('coilData');
      const savedVehicleData = localStorage.getItem('vehicleData');
      const savedOutData = localStorage.getItem('outData');
      const savedSerialCounter = localStorage.getItem('serialCounter');
      const savedFileName = localStorage.getItem('loadedFileName');
      
      if (savedCoilData) {
        coilData = JSON.parse(savedCoilData);
      }
      if (savedVehicleData) {
        vehicleData = JSON.parse(savedVehicleData);
      }
      if (savedOutData) {
        outData = JSON.parse(savedOutData);
      }
      if (savedSerialCounter) {
        serialCounter = parseInt(savedSerialCounter);
      }
      if (savedFileName) {
        loadedFileName = savedFileName;
        document.getElementById('fileName').textContent = `Loaded: ${loadedFileName}`;
      }
      
      // Auto-load from GitHub if no local data
      if (coilData.length === 0) {
        await autoLoadFromGithub();
      }
      
      // Load OUT data from GitHub for reporting
      try {
        const githubOutData = await loadOutDataFromGithub();
        console.log('Auto-loaded OUT data:', githubOutData.length, 'records');
      } catch (error) {
        console.log('Could not auto-load OUT data from GitHub');
      }
      
      // Set up file input handler
      document.getElementById('excelFile').addEventListener('change', handleFileSelect);
    });

    // Auto-load Excel data from GitHub on startup
    async function autoLoadFromGithub() {
      try {
        console.log('Auto-loading data from GitHub...');
        const response = await fetch(GITHUB_EXCEL_URL);
        if (!response.ok) throw new Error('Failed to fetch Excel file');
        
        const arrayBuffer = await response.arrayBuffer();
        const workbook = XLSX.read(new Uint8Array(arrayBuffer), { type: 'array' });
        
        // Load COIL sheet
        if (workbook.SheetNames.includes('COIL')) {
          const coilSheet = workbook.Sheets['COIL'];
          coilData = XLSX.utils.sheet_to_json(coilSheet);
          localStorage.setItem('coilData', JSON.stringify(coilData));
        }
        
        // Load VEH sheet  
        if (workbook.SheetNames.includes('VEH')) {
          const vehicleSheet = workbook.Sheets['VEH'];
          vehicleData = XLSX.utils.sheet_to_json(vehicleSheet);
          localStorage.setItem('vehicleData', JSON.stringify(vehicleData));
        }
        
        // Load OUT sheet for serial counter
        if (workbook.SheetNames.includes('OUT')) {
          const outSheet = workbook.Sheets['OUT'];
          const outSheetData = XLSX.utils.sheet_to_json(outSheet);
          if (outSheetData.length > 0) {
            const maxSerial = Math.max(...outSheetData.map(row => parseInt(row['Serial No']) || 0));
            serialCounter = maxSerial + 1;
            localStorage.setItem('serialCounter', serialCounter.toString());
          }
        }
        
        loadedFileName = 'GitHub: coil-data.xlsx';
        localStorage.setItem('loadedFileName', loadedFileName);
        document.getElementById('fileName').textContent = `Auto-loaded: ${loadedFileName}`;
        
        console.log('Auto-loaded data successfully:', {
          coils: coilData.length,
          vehicles: vehicleData.length,
          nextSerial: serialCounter
        });
      } catch (error) {
        console.error('Auto-load failed:', error);
        document.getElementById('fileName').textContent = 'Auto-load failed. Please upload Excel file manually.';
      }
    }

    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          
          // Load COIL sheet
          if (workbook.SheetNames.includes('COIL')) {
            const coilSheet = workbook.Sheets['COIL'];
            coilData = XLSX.utils.sheet_to_json(coilSheet);
            localStorage.setItem('coilData', JSON.stringify(coilData));
          }
          
          // Load VEH sheet
          if (workbook.SheetNames.includes('VEH')) {
            const vehicleSheet = workbook.Sheets['VEH'];
            vehicleData = XLSX.utils.sheet_to_json(vehicleSheet);
            localStorage.setItem('vehicleData', JSON.stringify(vehicleData));
          }
          
          // Load OUT sheet for existing data and serial counter
          if (workbook.SheetNames.includes('OUT')) {
            const outSheet = workbook.Sheets['OUT'];
            outData = XLSX.utils.sheet_to_json(outSheet);
            localStorage.setItem('outData', JSON.stringify(outData));
            
            if (outData.length > 0) {
              const maxSerial = Math.max(...outData.map(row => parseInt(row['Serial No']) || 0));
              serialCounter = maxSerial + 1;
              localStorage.setItem('serialCounter', serialCounter.toString());
            }
          }
          
          loadedFileName = file.name;
          localStorage.setItem('loadedFileName', loadedFileName);
          document.getElementById('fileName').textContent = `Loaded: ${loadedFileName}`;
          alert('Excel file loaded successfully!');
        } catch (error) {
          alert('Error reading Excel file: ' + error.message);
        }
      };
      reader.readAsArrayBuffer(file);
    }

    function searchCoil() {
      const coilNumber = document.getElementById('coilInput').value.trim().toUpperCase();
      const resultDiv = document.getElementById('result');
      
      if (!coilNumber) {
        resultDiv.innerHTML = '';
        return;
      }
      
      if (coilData.length === 0) {
        resultDiv.innerHTML = '<p style="color: #ff6b6b;">No Excel data loaded. Please upload an Excel file first.</p>';
        return;
      }
      
      const matchKey = Object.keys(coilData[0] || {}).find(key => 
        key.trim().toUpperCase() === 'MILL COIL NO' || 
        key.trim().toUpperCase() === 'COIL NO' ||
        key.trim().toUpperCase().includes('MILL COIL')
      );
      
      if (!matchKey) {
        resultDiv.innerHTML = '<p style="color: #ff6b6b;">Could not find MILL COIL NO column in Excel data.</p>';
        return;
      }
      
      const coil = coilData.find(row => 
        String(row[matchKey]).trim().toUpperCase() === coilNumber
      );
      
      if (coil) {
        let html = '<table>';
        Object.entries(coil).forEach(([key, value]) => {
          if (value !== null && value !== undefined && value !== '') {
            html += `<tr><td><strong>${key}:</strong></td><td>${value}</td></tr>`;
          }
        });
        html += '</table>';
        resultDiv.innerHTML = html;
      } else {
        resultDiv.innerHTML = '<p style="color: #ff6b6b;">Coil not found in database.</p>';
      }
    }

    function showSuggestions() {
      const input = document.getElementById('coilInput').value.trim().toUpperCase();
      const suggestions = document.getElementById('suggestions');
      
      if (input.length === 0) {
        suggestions.style.display = 'none';
        return;
      }
      
      const matches = coilData.filter(row => {
        const matchKey = Object.keys(row).find(k => k.trim().toUpperCase() === 'MILL COIL NO');
        return matchKey && String(row[matchKey]).trim().toUpperCase().includes(input);
      }).slice(0, 10);
      
      if (matches.length > 0) {
        suggestions.innerHTML = matches.map(row => {
          const matchKey = Object.keys(row).find(k => k.trim().toUpperCase() === 'MILL COIL NO');
          return `<div onclick="selectSuggestion('${row[matchKey]}')">${row[matchKey]}</div>`;
        }).join('');
        suggestions.style.display = 'block';
      } else {
        suggestions.style.display = 'none';
      }
    }

    function selectSuggestion(coilNumber) {
      document.getElementById('coilInput').value = coilNumber;
      document.getElementById('suggestions').style.display = 'none';
      searchCoil();
      toggleClearButton();
    }

    function toggleClearButton() {
      // This function exists for compatibility but doesn't need to do anything
      // since there's no clearInputBtn in the original design
    }

    function startScanner() {
      const reader = document.getElementById('reader');
      if (html5QrCode && html5QrCode.getState() === Html5QrcodeScannerState.SCANNING) {
        return;
      }
      
      html5QrCode = new Html5Qrcode("reader");
      html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: { width: 250, height: 250 } },
        (decodedText) => {
          document.getElementById('coilInput').value = decodedText;
          searchCoil();
          toggleClearButton();
          html5QrCode.stop();
        },
        (errorMessage) => {
          // Ignore errors for cleaner console
        }
      );
    }

    function closeScanner() {
      if (html5QrCode) {
        html5QrCode.stop();
      }
    }

    // Vehicle functions
    function showVehicleSuggestions() {
      const input = document.getElementById('vehicleInput').value.trim().toUpperCase();
      const suggestions = document.getElementById('vehicleSuggestions');
      
      if (input.length === 0) {
        suggestions.style.display = 'none';
        return;
      }
      
      const matches = vehicleData.filter(row => {
        const matchKey = Object.keys(row).find(k => k.trim().toUpperCase() === 'VEHICLE NO');
        return matchKey && String(row[matchKey]).trim().toUpperCase().includes(input);
      }).slice(0, 10);
      
      if (matches.length > 0) {
        suggestions.innerHTML = matches.map(row => {
          const matchKey = Object.keys(row).find(k => k.trim().toUpperCase() === 'VEHICLE NO');
          return `<div onclick="selectVehicleSuggestion('${row[matchKey]}')">${row[matchKey]}</div>`;
        }).join('');
        suggestions.style.display = 'block';
      } else {
        suggestions.style.display = 'none';
      }
    }

    function selectVehicleSuggestion(vehicleNumber) {
      document.getElementById('vehicleInput').value = vehicleNumber;
      document.getElementById('vehicleSuggestions').style.display = 'none';
      toggleVehicleClearButton();
    }

    function toggleVehicleClearButton() {
      const input = document.getElementById('vehicleInput').value.trim();
      const clearBtn = document.getElementById('clearVehicleBtn');
      clearBtn.style.display = input ? 'block' : 'none';
    }

    function clearVehicleInput() {
      document.getElementById('vehicleInput').value = '';
      document.getElementById('vehicleSuggestions').style.display = 'none';
      toggleVehicleClearButton();
    }

    function addCoilToVehicle() {
    document.getElementById('vehicleInput').disabled = true;
    const coilInput = document.getElementById('coilInput'); // Get the coil input element
    const coil = coilInput.value.trim().toUpperCase();
    const vehicle = document.getElementById('vehicleInput').value.trim().toUpperCase();
    if (!coil || !vehicle) return alert('Enter both coil and vehicle number.');
    addedCoils.push({ coilNumber: coil, vehicleNumber: vehicle });
    updateAddedCoilsDisplay();
    coilInput.value = ''; // Clear the coil input field
    document.getElementById('result').innerHTML = ''; // Clear the displayed coil details
    document.getElementById('suggestions').style.display = 'none'; // Hide suggestions
    }

    function updateAddedCoilsDisplay() {
      const div = document.getElementById('addedCoils');
      if (addedCoils.length === 0) {
        div.innerHTML = '';
        return;
      }
      
      let html = '<h3>Added Coils:</h3>';
      addedCoils.forEach((item, index) => {
        html += `<div style="background: rgba(255,255,255,0.1); padding: 8px; margin: 5px 0; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
          <span>${item.coilNumber} â†’ ${item.vehicleNumber}</span>
          <button onclick="removeCoil(${index})" style="padding: 2px 4px; font-size: 9px; background: #e74c3c; color: white; border: none; border-radius: 2px; cursor: pointer; min-width: 45px;">Remove</button>
        </div>`;
      });
      div.innerHTML = html;
    }

    function removeCoil(index) {
      addedCoils.splice(index, 1);
      updateAddedCoilsDisplay();
    }

    function saveVehicleCoils() {
      if (!addedCoils.length) return alert('No coils to save.');
      addedCoils.forEach(({ coilNumber, vehicleNumber }) => {
        if (!vehicleCoilMap[vehicleNumber]) vehicleCoilMap[vehicleNumber] = [];
        vehicleCoilMap[vehicleNumber].push(coilNumber);
      });
      addedCoils = [];
      updateAddedCoilsDisplay();
      document.getElementById('generateBtn').disabled = false;
      document.getElementById('addBtn').disabled = true;
      document.getElementById('saveBtn').disabled = true;
    }

    // Enhanced generateTextFile function with mobile-compatible download
    async function generateTextFile() {
      document.getElementById('vehicleInput').disabled = false;
      
      const now = new Date();
      const currentDate = now.toLocaleDateString('en-GB').replace(/\//g, '-'); // DD-MM-YYYY format
      const currentTime = now.toLocaleTimeString('en-US', { hour12: true }); // 12-hour format with AM/PM
      
      // Generate separate file for each vehicle
      for (const [vehicle, coils] of Object.entries(vehicleCoilMap)) {
        // Find transporter for this vehicle from VEH sheet
        let transporter = '';
        if (vehicleData.length > 0) {
          const vehicleColumnKey = Object.keys(vehicleData[0]).find(key => 
            key.trim().toUpperCase().includes('VEHICLE NO') || 
            key.trim().toUpperCase().includes('VEHICLENO') ||
            key.trim().toUpperCase() === 'VEHICLE NO'
          );
          
          const transporterColumnKey = Object.keys(vehicleData[0]).find(key => 
            key.trim().toUpperCase().includes('TRANSPORTER') || 
            key.trim().toUpperCase().includes('TRANSPORT')
          );
          
          if (vehicleColumnKey && transporterColumnKey) {
            const vehicleRecord = vehicleData.find(row => 
              String(row[vehicleColumnKey]).trim().toUpperCase() === vehicle
            );
            if (vehicleRecord) {
              transporter = vehicleRecord[transporterColumnKey] || '';
            }
          }
        }
        
        // Create content for text file in exact original format
        let content = `A.S.Shipping Agencies Pvt Ltd,\n`;
        content += `(Greenways Group)\n`;
        content += `--------------------------------------------\n`;
        content += `Vehicle: ${vehicle}`;
        if (transporter) {
          content += ` | Transporter: ${transporter}`;
        }
        content += `\n`;
        content += `Generated On: ${currentDate} at ${currentTime}\n`;
        content += `--------------------------------------------\n`;
        
        let vehicleGrossTotal = 0;
        coils.forEach(coil => {
          const found = coilData.find(row => {
            const matchKey = Object.keys(row).find(k => k.trim().toUpperCase() === 'MILL COIL NO');
            return matchKey && String(row[matchKey]).trim().toUpperCase() === coil;
          });
          const grossWT = found ? (found['GROSS WT'] || found['Gross WT'] || 0) : 0;
          vehicleGrossTotal += parseFloat(grossWT) || 0;
          content += `Coil No: ${coil}, Gross WT: ${grossWT}\n`;
        });
        
        content += `\nTotal No of Coils : ${coils.length}\n`;
        content += `Total Gross WT : ${vehicleGrossTotal.toFixed(2)}\n`;
        content += `--------------------------------------------\n`;
        
        const fileName = `${vehicle}_${currentDate.replace(/-/g, '')}.txt`;
        
        // Enhanced mobile download function
        try {
          // Create blob
          const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
          
          // For modern browsers with File System Access API
          if ('showSaveFilePicker' in window) {
            try {
              const fileHandle = await window.showSaveFilePicker({
                suggestedName: fileName,
                types: [{
                  description: 'Text files',
                  accept: { 'text/plain': ['.txt'] }
                }]
              });
              const writable = await fileHandle.createWritable();
              await writable.write(content);
              await writable.close();
              console.log('File saved using File System Access API');
              continue; // Skip to next vehicle
            } catch (error) {
              if (error.name === 'AbortError') {
                console.log('User cancelled file save');
                continue; // Skip to next vehicle
              }
              // Fall through to traditional download
            }
          }
          
          // Traditional download for all other browsers
          const url = URL.createObjectURL(blob);
          const downloadLink = document.createElement('a');
          downloadLink.href = url;
          downloadLink.download = fileName;
          downloadLink.style.display = 'none';
          
          // Add to DOM and trigger click
          document.body.appendChild(downloadLink);
          downloadLink.click();
          
          // Cleanup
          setTimeout(() => {
            document.body.removeChild(downloadLink);
            URL.revokeObjectURL(url);
          }, 100);
          
        } catch (error) {
          console.error('Download failed:', error);
          alert('Download failed. Please try again.');
          return;
        }
        
        // Prepare data for GitHub Excel storage
        const outEntries = [];
        coils.forEach(coilNumber => {
          const coilDetails = coilData.find(row => {
            const matchKey = Object.keys(row).find(k => k.trim().toUpperCase() === 'MILL COIL NO');
            return matchKey && String(row[matchKey]).trim().toUpperCase() === coilNumber;
          });
          
          if (coilDetails) {
            const grossWT = coilDetails['GROSS WT'] || coilDetails['Gross WT'] || 0;
            const outEntry = {
              'Serial No': serialCounter++,
              'Date & Time': formatDateTime(new Date()),
              'Vehicle No': vehicle,
              'Mill Coil No': coilNumber,
              'TRANSPORTER': transporter,
              'GROSS WT': grossWT
            };
            outData.push(outEntry);
            outEntries.push(outEntry);
          }
        });
        
        // Store data in GitHub Excel file for multi-user access
        try {
          await storeDataInGithubExcel(outEntries);
          console.log('Data prepared for GitHub Excel multi-user storage');
        } catch (error) {
          console.error('Failed to prepare data for GitHub Excel:', error);
          alert('Data saved locally. For multi-user access, please upload the downloaded Excel file to GitHub.');
        }
      }
      
      // Save updated OUT data and serial counter to localStorage
      localStorage.setItem('outData', JSON.stringify(outData));
      localStorage.setItem('serialCounter', serialCounter.toString());
      
      // Reset button states like the original
      document.getElementById('generateBtn').disabled = true;
      document.getElementById('vehicleInput').value = '';
      document.getElementById('addBtn').disabled = false;
      document.getElementById('saveBtn').disabled = false;
      
      // Clear the vehicle coil map
      vehicleCoilMap = {};
      
      alert('Text files generated successfully!');
    }

    function clearInputs() {
      document.getElementById('coilInput').value = '';
      document.getElementById('result').innerHTML = '';
      document.getElementById('suggestions').style.display = 'none';
    }

    // Report generation functions with GitHub data integration
    async function showReportVehicleSuggestions() {
      const input = document.getElementById('reportVehicleInput').value.trim().toUpperCase();
      const suggestions = document.getElementById('reportVehicleSuggestions');
      
      if (input.length === 0) {
        suggestions.style.display = 'none';
        return;
      }
      
      try {
        // Load OUT data from GitHub Excel file
        const githubOutData = await loadOutDataFromGithub();
        
        // Combine with local data if any
        const allOutData = [...githubOutData, ...outData];
        
        const matches = allOutData.filter(row => {
          const vehicle = row['Vehicle No'] || '';
          return String(vehicle).trim().toUpperCase().includes(input);
        }).slice(0, 10);
        
        // Get unique vehicle numbers
        const uniqueVehicles = [...new Set(matches.map(row => row['Vehicle No']))];
        
        if (uniqueVehicles.length > 0) {
          suggestions.innerHTML = uniqueVehicles.map(vehicle => 
            `<div onclick="selectReportVehicleSuggestion('${vehicle}')">${vehicle}</div>`
          ).join('');
          suggestions.style.display = 'block';
        } else {
          suggestions.style.display = 'none';
        }
      } catch (error) {
        console.error('Error loading vehicle suggestions:', error);
        // Fallback to local data only
        const matches = outData.filter(row => {
          const vehicle = row['Vehicle No'] || '';
          return String(vehicle).trim().toUpperCase().includes(input);
        }).slice(0, 10);
        
        const uniqueVehicles = [...new Set(matches.map(row => row['Vehicle No']))];
        
        if (uniqueVehicles.length > 0) {
          suggestions.innerHTML = uniqueVehicles.map(vehicle => 
            `<div onclick="selectReportVehicleSuggestion('${vehicle}')">${vehicle}</div>`
          ).join('');
          suggestions.style.display = 'block';
        } else {
          suggestions.style.display = 'none';
        }
      }
    }

    function selectReportVehicleSuggestion(vehicleNumber) {
      document.getElementById('reportVehicleInput').value = vehicleNumber;
      document.getElementById('reportVehicleSuggestions').style.display = 'none';
      toggleReportVehicleClearButton();
    }

    function toggleReportVehicleClearButton() {
      const input = document.getElementById('reportVehicleInput').value.trim();
      const clearBtn = document.getElementById('clearReportVehicleBtn');
      clearBtn.style.display = input ? 'block' : 'none';
    }

    function clearReportVehicleInput() {
      document.getElementById('reportVehicleInput').value = '';
      document.getElementById('reportVehicleSuggestions').style.display = 'none';
      toggleReportVehicleClearButton();
    }

    // Enhanced generateAllOutDataReport function reading from GitHub OUT sheet
    async function generateAllOutDataReport() {
      try {
        // Load OUT data from GitHub Excel file for comprehensive reporting
        const githubOutData = await loadOutDataFromGithub();
        
        // Combine with local data for complete dataset
        const allOutData = [...githubOutData, ...outData];
        
        if (allOutData.length === 0) {
          alert('No OUT data available to generate report.\n\nTo create OUT data:\n1. Enter a coil number\n2. Enter a vehicle number\n3. Click "Add Coil"\n4. Click "Save"\n5. Click "Generate Text"\n\nThen try generating reports again.');
          return;
        }
        
        // Sort by Serial No for proper ordering
        allOutData.sort((a, b) => (parseInt(a['Serial No']) || 0) - (parseInt(b['Serial No']) || 0));
        
        // Format data with proper column headers and calculate total
        const formattedData = allOutData.map(row => ({
          'SERIAL NO': row['Serial No'] || '',
          'DATE & TIME': row['Date & Time'] || '',
          'VEHICLE NO': row['Vehicle No'] || '',
          'MILL COIL NO': row['Mill Coil No'] || '',
          'TRANSPORTER': row['TRANSPORTER'] || '',
          'GROSS WT': parseFloat(row['GROSS WT']) || 0
        }));
        
        // Calculate total gross weight
        const totalGrossWT = formattedData.reduce((sum, row) => sum + (parseFloat(row['GROSS WT']) || 0), 0);
        
        // Add total row
        formattedData.push({
          'SERIAL NO': '',
          'DATE & TIME': '',
          'VEHICLE NO': '',
          'MILL COIL NO': '',
          'TRANSPORTER': 'TOTAL',
          'GROSS WT': totalGrossWT
        });
        
        // Create Excel workbook
        const workbook = XLSX.utils.book_new();
        const worksheet = XLSX.utils.json_to_sheet(formattedData);
        
        // Format the worksheet
        const range = XLSX.utils.decode_range(worksheet['!ref']);
        
        // Style the header row
        for (let col = range.s.c; col <= range.e.c; col++) {
          const cellAddress = XLSX.utils.encode_cell({r: 0, c: col});
          if (!worksheet[cellAddress]) continue;
          worksheet[cellAddress].s = {
            font: { bold: true },
            fill: { fgColor: { rgb: "CCCCCC" } }
          };
        }
        
        // Style the total row
        const totalRowIndex = formattedData.length - 1;
        for (let col = range.s.c; col <= range.e.c; col++) {
          const cellAddress = XLSX.utils.encode_cell({r: totalRowIndex, c: col});
          if (!worksheet[cellAddress]) continue;
          worksheet[cellAddress].s = {
            font: { bold: true },
            fill: { fgColor: { rgb: "FFFFCC" } }
          };
        }
        
        XLSX.utils.book_append_sheet(workbook, worksheet, 'All OUT Data');
        
        // Generate Excel file
        const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
        const blob = new Blob([excelBuffer], { type: 'application/octet-stream' });
        
        const now = new Date();
        const dateStr = now.toLocaleDateString('en-GB').replace(/\//g, '-');
        const fileName = `All_OUT_Data_Report_${dateStr}.xlsx`;
        
        // Download the file
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        alert(`All OUT Data Report generated successfully!\nTotal records: ${allOutData.length}\nTotal Gross Weight: ${totalGrossWT.toFixed(2)}`);
      } catch (error) {
        console.error('Error generating all OUT data report:', error);
        alert('Error generating report: ' + error.message + '\n\nPlease ensure you have generated some text files first to create OUT data.');
      }
    }

    // Enhanced generateVehicleOutReport function with GitHub data
    async function generateVehicleOutReport() {
      const vehicleNumber = document.getElementById('reportVehicleInput').value.trim().toUpperCase();
      if (!vehicleNumber) {
        alert('Please enter a vehicle number for the report.');
        return;
      }
      
      try {
        // Load OUT data from GitHub Excel file
        const githubOutData = await loadOutDataFromGithub();
        
        // Combine with local data
        const allOutData = [...githubOutData, ...outData];
        
        if (allOutData.length === 0) {
          alert('No OUT data available.\n\nTo create OUT data:\n1. Enter a coil number\n2. Enter a vehicle number\n3. Click "Add Coil"\n4. Click "Save"\n5. Click "Generate Text"\n\nThen try generating reports again.');
          return;
        }
        
        // Filter data for the specific vehicle
        const vehicleDataForReport = allOutData.filter(row => 
          String(row['Vehicle No']).trim().toUpperCase() === vehicleNumber
        );
        
        if (vehicleDataForReport.length === 0) {
          alert(`No data found for vehicle: ${vehicleNumber}\n\nMake sure the vehicle number is correct and that you have generated text files for this vehicle.`);
          return;
        }
        
        // Sort by Serial No
        vehicleDataForReport.sort((a, b) => (parseInt(a['Serial No']) || 0) - (parseInt(b['Serial No']) || 0));
        
        // Format data with proper column headers and calculate total
        const formattedData = vehicleDataForReport.map(row => ({
          'SERIAL NO': row['Serial No'] || '',
          'DATE & TIME': row['Date & Time'] || '',
          'VEHICLE NO': row['Vehicle No'] || '',
          'MILL COIL NO': row['Mill Coil No'] || '',
          'TRANSPORTER': row['TRANSPORTER'] || '',
          'GROSS WT': parseFloat(row['GROSS WT']) || 0
        }));
        
        // Calculate total gross weight
        const totalGrossWT = formattedData.reduce((sum, row) => sum + (parseFloat(row['GROSS WT']) || 0), 0);
        
        // Add total row
        formattedData.push({
          'SERIAL NO': '',
          'DATE & TIME': '',
          'VEHICLE NO': '',
          'MILL COIL NO': '',
          'TRANSPORTER': 'TOTAL',
          'GROSS WT': totalGrossWT
        });
        
        // Create Excel workbook
        const workbook = XLSX.utils.book_new();
        const worksheet = XLSX.utils.json_to_sheet(formattedData);
        
        // Format the worksheet
        const range = XLSX.utils.decode_range(worksheet['!ref']);
        
        // Style the header row
        for (let col = range.s.c; col <= range.e.c; col++) {
          const cellAddress = XLSX.utils.encode_cell({r: 0, c: col});
          if (!worksheet[cellAddress]) continue;
          worksheet[cellAddress].s = {
            font: { bold: true },
            fill: { fgColor: { rgb: "CCCCCC" } }
          };
        }
        
        // Style the total row
        const totalRowIndex = formattedData.length - 1;
        for (let col = range.s.c; col <= range.e.c; col++) {
          const cellAddress = XLSX.utils.encode_cell({r: totalRowIndex, c: col});
          if (!worksheet[cellAddress]) continue;
          worksheet[cellAddress].s = {
            font: { bold: true },
            fill: { fgColor: { rgb: "FFFFCC" } }
          };
        }
        
        XLSX.utils.book_append_sheet(workbook, worksheet, `Vehicle ${vehicleNumber}`);
        
        // Generate Excel file
        const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
        const blob = new Blob([excelBuffer], { type: 'application/octet-stream' });
        
        const now = new Date();
        const dateStr = now.toLocaleDateString('en-GB').replace(/\//g, '-');
        const fileName = `Vehicle_${vehicleNumber}_Report_${dateStr}.xlsx`;
        
        // Download the file
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        alert(`Vehicle report generated successfully!\nRecords found: ${vehicleDataForReport.length}\nTotal Gross Weight: ${totalGrossWT.toFixed(2)}`);
      } catch (error) {
        console.error('Error generating vehicle report:', error);
        alert('Error generating vehicle report: ' + error.message + '\n\nPlease ensure you have generated some text files first to create OUT data.');
      }
    }

    function downloadExcel() {
      if (outData.length === 0) {
        alert('No data to download. Generate some text files first.');
        return;
      }
      
      // Create workbook with multiple sheets
      const workbook = XLSX.utils.book_new();
      
      // Add COIL sheet if available
      if (coilData.length > 0) {
        const coilSheet = XLSX.utils.json_to_sheet(coilData);
        XLSX.utils.book_append_sheet(workbook, coilSheet, 'COIL');
      }
      
      // Add VEH sheet if available
      if (vehicleData.length > 0) {
        const vehicleSheet = XLSX.utils.json_to_sheet(vehicleData);
        XLSX.utils.book_append_sheet(workbook, vehicleSheet, 'VEH');
      }
      
      // Add OUT sheet
      const outSheet = XLSX.utils.json_to_sheet(outData);
      XLSX.utils.book_append_sheet(workbook, outSheet, 'OUT');
      
      // Generate Excel file
      const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
      const blob = new Blob([excelBuffer], { type: 'application/octet-stream' });
      
      const now = new Date();
      const dateStr = now.toLocaleDateString('en-GB').replace(/\//g, '-');
      const fileName = `coil-data-updated-${dateStr}.xlsx`;
      
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = fileName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      alert('Excel file downloaded successfully!');
    }

    function clearLocalStorage() {
      if (confirm('This will clear all locally stored data. Are you sure?')) {
        localStorage.removeItem('coilData');
        localStorage.removeItem('vehicleData');
        localStorage.removeItem('outData');
        localStorage.removeItem('serialCounter');
        localStorage.removeItem('loadedFileName');
        localStorage.removeItem('githubOutData');
        localStorage.removeItem('githubOutDataTimestamp');
        alert('Local storage cleared successfully!');
        location.reload();
      }
    }

    function resetApp() {
      if (confirm('This will clear all data and reset the app. Are you sure?')) {
        localStorage.clear();
        location.reload();
      }
    }

    async function updateAppFromGithub() {
      if (confirm('This will update the app from GitHub. The page will reload. Continue?')) {
        try {
          // Fetch the latest HTML from GitHub
          const response = await fetch(GITHUB_HTML_URL);
          if (!response.ok) {
            throw new Error('Failed to fetch the latest version from GitHub');
          }
          
          const latestHtml = await response.text();
          
          // Replace the current page content
          document.open();
          document.write(latestHtml);
          document.close();
          
          alert('App updated successfully from GitHub!');
        } catch (error) {
          console.error('Update error:', error);
          alert('Failed to update app from GitHub: ' + error.message);
        }
      }
    }

    function setGithubToken() {
      const currentToken = localStorage.getItem('githubToken');
      const message = currentToken 
        ? 'Enter new GitHub Personal Access Token (leave empty to keep current):'
        : 'Enter your GitHub Personal Access Token for direct updates:';
      
      const token = prompt(message);
      if (token) {
        localStorage.setItem('githubToken', token);
        alert('GitHub token updated successfully!');
      } else if (!currentToken) {
        alert('GitHub token is required for multi-user data synchronization.');
      }
    }
  </script>
</body>
</html>